<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>Arcade Shooter 2.0 â€” Mobile Optimized</title>
  <style>
    :root{--bg:#070c18;--accent:#4ee1a0;--danger:#ff5b5b;--muted:#94a3b8}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#08101a 0%, #07121a 60%);color:#e6eef7;font-family:Inter, system-ui, Arial;overflow:hidden}
    canvas{width:100%;height:100%;display:block;touch-action:none}
    #hud{position:fixed;top:10px;left:10px;font-size:15px;background:rgba(0,0,0,0.3);padding:6px 12px;border-radius:8px;backdrop-filter:blur(3px)}
    #hud div{margin:2px 0}
    .btn{background:var(--accent);color:#041915;padding:8px 12px;border:none;border-radius:8px;font-weight:700;cursor:pointer}
    #pause{position:fixed;top:10px;right:10px}
    .touch-stick{position:fixed;left:20px;bottom:20px;width:140px;height:140px;border-radius:50%;background:radial-gradient(circle,rgba(255,255,255,0.05),rgba(255,255,255,0.02));display:flex;align-items:center;justify-content:center}
    .stick-knob{width:60px;height:60px;border-radius:50%;background:rgba(255,255,255,0.1);backdrop-filter:blur(3px)}
    .touch-fire{position:fixed;right:24px;bottom:24px;width:88px;height:88px;border-radius:50%;background:radial-gradient(circle at 30% 30%, rgba(255,255,255,0.08), rgba(255,255,255,0.03));display:flex;align-items:center;justify-content:center;font-weight:900;color:var(--danger);font-size:20px;box-shadow:0 0 12px rgba(0,0,0,0.5)}
    #weaponSelect{position:fixed;bottom:120px;right:20px;display:flex;flex-direction:column;gap:8px}
    .weaponBtn{background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.1);color:#fff;padding:4px 8px;border-radius:6px;font-size:14px}
    .active{background:var(--accent);color:#000;font-weight:700}
    #gameOver{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);color:#fff;align-items:center;justify-content:center;flex-direction:column;font-size:24px;text-align:center}
  </style>
</head>
<body>
  <canvas id="game"></canvas>
  <div id="hud"><div>Score: <span id="score">0</span></div><div>HP: <span id="hp">100</span></div><div>Level: <span id="level">1</span></div></div>
  <button class="btn" id="pause">Pause</button>
  <div class="touch-stick" id="stick"><div class="stick-knob" id="knob"></div></div>
  <div class="touch-fire" id="fireBtn">FIRE</div>
  <div id="weaponSelect"></div>
  <div id="gameOver"><div>GAME OVER</div><button class="btn" id="restart">Restart</button></div>
  <script>
  (()=>{
    const c=document.getElementById('game');const ctx=c.getContext('2d');
    const resize=()=>{c.width=innerWidth;c.height=innerHeight};window.addEventListener('resize',resize);resize();

    let running=true,score=0,level=1,enemies=[],bullets=[],particles=[];
    const player={x:c.width/2,y:c.height/2,r:14,spd:200,angle:0,hp:100,cooldown:0,weapon:'pistol'};
    const weapons={
      pistol:{rate:0.25,spd:500,damage:1,color:'#fff'},
      shotgun:{rate:0.6,spd:400,damage:1,spread:0.25,shots:5,color:'#ffb86b'},
      laser:{rate:0.1,spd:800,damage:0.6,color:'#00f0ff'}
    };

    const keys={};window.addEventListener('keydown',e=>keys[e.key.toLowerCase()]=true);window.addEventListener('keyup',e=>keys[e.key.toLowerCase()]=false);

    let mouse={x:0,y:0,down:false};c.addEventListener('mousemove',e=>{mouse.x=e.clientX;mouse.y=e.clientY});c.addEventListener('mousedown',()=>mouse.down=true);window.addEventListener('mouseup',()=>mouse.down=false);

    const stick=document.getElementById('stick');const knob=document.getElementById('knob');const fireBtn=document.getElementById('fireBtn');
    let activeStick=null,moveX=0,moveY=0,autoFire=false;

    stick.addEventListener('touchstart',e=>{activeStick=e.changedTouches[0].identifier});
    window.addEventListener('touchmove',e=>{
      for(const t of e.changedTouches){if(t.identifier===activeStick){const dx=t.clientX-90,dy=t.clientY-(innerHeight-90);const dist=Math.min(50,Math.hypot(dx,dy));const ang=Math.atan2(dy,dx);knob.style.transform=`translate(${Math.cos(ang)*dist-30}px,${Math.sin(ang)*dist-30}px)`;moveX=Math.cos(ang)*(dist/50);moveY=Math.sin(ang)*(dist/50);}}
    },{passive:true});
    window.addEventListener('touchend',e=>{for(const t of e.changedTouches){if(t.identifier===activeStick){activeStick=null;moveX=0;moveY=0;knob.style.transform='translate(-30px,-30px)';}}});
    fireBtn.addEventListener('touchstart',()=>autoFire=true,{passive:true});fireBtn.addEventListener('touchend',()=>autoFire=false,{passive:true});

    const weaponSelect=document.getElementById('weaponSelect');
    Object.keys(weapons).forEach(name=>{const b=document.createElement('button');b.className='weaponBtn';b.textContent=name;b.onclick=()=>{player.weapon=name;updateWeaponButtons();};weaponSelect.appendChild(b)});
    function updateWeaponButtons(){document.querySelectorAll('.weaponBtn').forEach(b=>{b.classList.toggle('active',b.textContent===player.weapon)});}
    updateWeaponButtons();

    function rnd(a,b){return Math.random()*(b-a)+a}
    function dist(a,b){return Math.hypot(a.x-b.x,a.y-b.y)}

    function spawnEnemy(boss=false){
      const x=rnd(0,c.width),y=rnd(0,c.height)<50? -30:c.height+30;
      const e={x,y,r:boss?40:rnd(12,25)+level*1.2,spd:boss?60:60+level*5,hp:boss?60+level*20:5+level, boss, color:boss?'#ff4545':'#ffb86b'};
      enemies.push(e);
    }

    let spawnTimer=1,bossTimer=30;

    function bullet(x,y,ang,owner='player'){const w=weapons[player.weapon];bullets.push({x,y,dx:Math.cos(ang)*w.spd,dy:Math.sin(ang)*w.spd,r:4,owner,ttl:3,damage:w.damage,color:w.color})}

    function explode(x,y,color,n=10){for(let i=0;i<n;i++){particles.push({x,y,dx:rnd(-150,150),dy:rnd(-150,150),ttl:rnd(0.3,1),age:0,color})}}

    function update(dt){
      if(!running)return;
      let vx=moveX,vy=moveY;if(keys['w'])vy-=1;if(keys['s'])vy+=1;if(keys['a'])vx-=1;if(keys['d'])vx+=1;const mag=Math.hypot(vx,vy)||1;player.x+=vx/mag*player.spd*dt;player.y+=vy/mag*player.spd*dt;
      player.x=Math.max(0,Math.min(c.width,player.x));player.y=Math.max(0,Math.min(c.height,player.y));
      player.angle=Math.atan2(mouse.y-player.y,mouse.x-player.x);

      const w=weapons[player.weapon];player.cooldown-=dt;
      if((mouse.down||autoFire)&&(player.cooldown<=0)){
        player.cooldown=w.rate;
        if(w.shots){for(let i=0;i<w.shots;i++){const a=player.angle+rnd(-w.spread,w.spread);bullet(player.x,player.y,a);}}
        else bullet(player.x,player.y,player.angle);
      }

      spawnTimer-=dt;bossTimer-=dt;if(spawnTimer<=0){spawnTimer=1;spawnEnemy();}if(bossTimer<=0){bossTimer=40;spawnEnemy(true);}

      for(let i=bullets.length-1;i>=0;i--){const b=bullets[i];b.x+=b.dx*dt;b.y+=b.dy*dt;b.ttl-=dt;if(b.ttl<=0){bullets.splice(i,1);continue;}
        for(let j=enemies.length-1;j>=0;j--){const e=enemies[j];if(dist(b,e)<e.r+b.r){e.hp-=b.damage;explode(b.x,b.y,b.color,4);bullets.splice(i,1);if(e.hp<=0){score+=e.boss?500:50;explode(e.x,e.y,e.color,e.boss?40:15);if(e.boss)level++;enemies.splice(j,1);}break;}}
      }

      for(let i=enemies.length-1;i>=0;i--){const e=enemies[i];const a=Math.atan2(player.y-e.y,player.x-e.x);e.x+=Math.cos(a)*e.spd*dt;e.y+=Math.sin(a)*e.spd*dt;if(dist(player,e)<e.r+player.r){player.hp-=e.boss?20:5;explode(e.x,e.y,'#ff7777',10);enemies.splice(i,1);if(player.hp<=0)gameOver();}}

      for(let i=particles.length-1;i>=0;i--){const p=particles[i];p.x+=p.dx*dt;p.y+=p.dy*dt;p.dx*=0.96;p.dy*=0.96;p.age+=dt;if(p.age>p.ttl)particles.splice(i,1);}

      document.getElementById('score').textContent=Math.floor(score);
      document.getElementById('hp').textContent=Math.floor(player.hp);
      document.getElementById('level').textContent=level;
    }

    function render(){ctx.clearRect(0,0,c.width,c.height);
      ctx.fillStyle='#0a0f1a';ctx.fillRect(0,0,c.width,c.height);
      for(const p of particles){ctx.globalAlpha=1-(p.age/p.ttl);ctx.fillStyle=p.color;ctx.fillRect(p.x,p.y,2,2);ctx.globalAlpha=1;}
      for(const e of enemies){ctx.beginPath();ctx.arc(e.x,e.y,e.r,0,Math.PI*2);ctx.fillStyle=e.color;ctx.fill();}
      for(const b of bullets){ctx.beginPath();ctx.arc(b.x,b.y,b.r,0,Math.PI*2);ctx.fillStyle=b.color;ctx.fill();}
      ctx.save();ctx.translate(player.x,player.y);ctx.rotate(player.angle);ctx.beginPath();ctx.arc(0,0,player.r,0,Math.PI*2);ctx.fillStyle='#6bffd0';ctx.fill();ctx.fillStyle='#043';ctx.fillRect(player.r-2,-4,14,8);ctx.restore();
    }

    let last=performance.now();function loop(now){const dt=Math.min(0.05,(now-last)/1000);last=now;update(dt);render();requestAnimationFrame(loop);}requestAnimationFrame(loop);

    function gameOver(){running=false;document.getElementById('gameOver').style.display='flex';}
    document.getElementById('restart').onclick=()=>{running=true;player.hp=100;score=0;level=1;enemies=[];bullets=[];particles=[];document.getElementById('gameOver').style.display='none';};
    document.getElementById('pause').onclick=()=>{running=!running;document.getElementById('pause').textContent=running?'Pause':'Resume';};
  })();
  </script>
</body>
</html>
